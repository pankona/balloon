<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="931px" preserveAspectRatio="none" style="width:599px;height:931px;" version="1.1" viewBox="0 0 599 931" width="599px" zoomAndPan="magnify"><defs><filter height="300%" id="fb5sud157l1a8" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FEFECE" filter="url(#fb5sud157l1a8)" height="28" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="284" y="101"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="291" y="120.3184">Spawner</text><rect fill="#FEFECE" filter="url(#fb5sud157l1a8)" height="28" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="361" y="171"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="368" y="190.3184">Factory</text><rect fill="#FFFFFF" filter="url(#fb5sud157l1a8)" height="572" style="stroke: #000000; stroke-width: 2.0;" width="564" x="13" y="330"/><rect fill="#FFFFFF" filter="url(#fb5sud157l1a8)" height="489" style="stroke: #000000; stroke-width: 2.0;" width="544" x="23" y="406"/><rect fill="#FFFFFF" filter="url(#fb5sud157l1a8)" height="92" style="stroke: #000000; stroke-width: 2.0;" width="282" x="145" y="560"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="73" x2="73" y1="50" y2="919"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="181" x2="181" y1="50" y2="919"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="317" x2="317" y1="132.5" y2="919"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="394" x2="394" y1="202.5" y2="919"/><rect fill="#FEFECE" filter="url(#fb5sud157l1a8)" height="42" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="33" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="40" y="22.3184">Main loop</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="47" y="36.3184">(Drive)</text><rect fill="#FEFECE" filter="url(#fb5sud157l1a8)" height="42" style="stroke: #A80036; stroke-width: 1.5;" width="49" x="155" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="162" y="22.3184">Event</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="162" y="36.3184">Queue</text><rect fill="#EEEEEE" filter="url(#fb5sud157l1a8)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="584" x="3" y="79.5"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="587" y1="79.5" y2="79.5"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="587" y1="82.5" y2="82.5"/><rect fill="#EEEEEE" filter="url(#fb5sud157l1a8)" height="21" style="stroke: #000000; stroke-width: 2.0;" width="54" x="268" y="70"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="274" y="85.4385">init</text><polygon fill="#A80036" points="272,116,282,120,272,124,276,120" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="73.5" x2="278" y1="120" y2="120"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="80.5" y="116.4385">new Spawner(frame counter)</text><rect fill="#FEFECE" filter="url(#fb5sud157l1a8)" height="28" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="284" y="101"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="291" y="120.3184">Spawner</text><polygon fill="#A80036" points="84.5,159,74.5,163,84.5,167,80.5,163" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="78.5" x2="316.5" y1="163" y2="163"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="90.5" y="159.4385">event subscribe</text><polygon fill="#A80036" points="349,186,359,190,349,194,353,190" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="73.5" x2="355" y1="190" y2="190"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="80.5" y="186.4385">new Factory</text><rect fill="#FEFECE" filter="url(#fb5sud157l1a8)" height="28" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="361" y="171"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="368" y="190.3184">Factory</text><polygon fill="#A80036" points="84.5,229,74.5,233,84.5,237,80.5,233" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="78.5" x2="393.5" y1="233" y2="233"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="90.5" y="229.4385">event subscribe</text><rect fill="#EEEEEE" filter="url(#fb5sud157l1a8)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="584" x="3" y="254"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="587" y1="254" y2="254"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="587" y1="257" y2="257"/><polygon fill="#A80036" points="305.5,284,315.5,288,305.5,292,309.5,288" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="73.5" x2="311.5" y1="288" y2="288"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="80.5" y="284.4385">run</text><polygon fill="#A80036" points="192.5,311,182.5,315,192.5,319,188.5,315" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="186.5" x2="316.5" y1="315" y2="315"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="198.5" y="311.4385">push(JudgeSpawn)</text><path d="M13,330 L90,330 L90,335 L80,345 L13,345 L13,330 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="572" style="stroke: #000000; stroke-width: 2.0;" width="564" x="13" y="330"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="28" y="342.4385">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="105" y="341.6787">[while game scene]</text><polygon fill="#A80036" points="169.5,360,179.5,364,169.5,368,173.5,364" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="73.5" x2="175.5" y1="364" y2="364"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="80.5" y="360.4385">fetch events</text><polygon fill="#A80036" points="84.5,387,74.5,391,84.5,395,80.5,391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="78.5" x2="180.5" y1="391" y2="391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="90.5" y="387.4385">events</text><path d="M23,406 L100,406 L100,411 L90,421 L23,421 L23,406 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="489" style="stroke: #000000; stroke-width: 2.0;" width="544" x="23" y="406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="38" y="418.4385">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="115" y="417.6787">[len(events)]</text><rect fill="#EEEEEE" filter="url(#fb5sud157l1a8)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="584" x="3" y="440.5"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="587" y1="440.5" y2="440.5"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="587" y1="443.5" y2="443.5"/><rect fill="#EEEEEE" filter="url(#fb5sud157l1a8)" height="21" style="stroke: #000000; stroke-width: 2.0;" width="174" x="208" y="431"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="152" x="214" y="446.4385">event is JudgeSpawn</text><polygon fill="#A80036" points="305.5,477,315.5,481,305.5,485,309.5,481" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="73.5" x2="311.5" y1="481" y2="481"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="80.5" y="477.4385">event publish</text><polygon fill="#A80036" points="382.5,504,392.5,508,382.5,512,386.5,508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="73.5" x2="388.5" y1="508" y2="508"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="80.5" y="504.4385">event publish</text><path d="M399,521 L399,544 L462,544 L462,531 L452,521 L399,521 " fill="#FBFB77" filter="url(#fb5sud157l1a8)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M452,521 L452,531 L462,531 L452,521 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="405" y="537.4385">ignore</text><path d="M145,560 L214,560 L214,565 L204,575 L145,575 L145,560 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="92" style="stroke: #000000; stroke-width: 2.0;" width="282" x="145" y="560"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="160" y="572.4385">alt</text><path d="M322,580 L322,616 L413,616 L413,590 L403,580 L322,580 " fill="#FBFB77" filter="url(#fb5sud157l1a8)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M403,580 L403,590 L413,590 L403,580 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="328" y="596.4385">push event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="328" y="609.4385">in random</text><polygon fill="#A80036" points="192.5,640,182.5,644,192.5,648,188.5,644" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="186.5" x2="316.5" y1="644" y2="644"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="198.5" y="640.4385">push(Spawn)</text><polygon fill="#A80036" points="192.5,674,182.5,678,192.5,682,188.5,678" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="186.5" x2="316.5" y1="678" y2="678"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="198.5" y="674.4385">push(JudgeSpawn)</text><rect fill="#EEEEEE" filter="url(#fb5sud157l1a8)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="584" x="3" y="705.5"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="587" y1="705.5" y2="705.5"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="587" y1="708.5" y2="708.5"/><rect fill="#EEEEEE" filter="url(#fb5sud157l1a8)" height="21" style="stroke: #000000; stroke-width: 2.0;" width="134" x="228" y="696"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="234" y="711.4385">event is Spawn</text><polygon fill="#A80036" points="305.5,742,315.5,746,305.5,750,309.5,746" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="73.5" x2="311.5" y1="746" y2="746"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="80.5" y="742.4385">event publish</text><path d="M322,759 L322,782 L385,782 L385,769 L375,759 L322,759 " fill="#FBFB77" filter="url(#fb5sud157l1a8)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M375,759 L375,769 L385,769 L375,759 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="328" y="775.4385">ignore</text><polygon fill="#A80036" points="382.5,806,392.5,810,382.5,814,386.5,810" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="73.5" x2="388.5" y1="810" y2="810"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="80.5" y="806.4385">event publish</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="394.5" x2="436.5" y1="837" y2="837"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="436.5" x2="436.5" y1="837" y2="850"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="395.5" x2="436.5" y1="850" y2="850"/><polygon fill="#A80036" points="405.5,846,395.5,850,405.5,854,401.5,850" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="401.5" y="833.4385">spawn()</text><path d="M399,863 L399,886 L553,886 L553,873 L543,863 L399,863 " fill="#FBFB77" filter="url(#fb5sud157l1a8)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M543,863 L543,873 L553,873 L543,863 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="405" y="879.4385">spawn a new balloon</text><!--
@startuml

hide footbox

participant "Main loop\n(Drive)" as m
participant "Event\nQueue"       as eq
participant Spawner              as s
participant Factory              as f

== init ==
create s
m -> s : new Spawner(frame counter)
m <- s : event subscribe
create f
m -> f : new Factory
m <- f : event subscribe
==  ==
m -> s : run
eq <- s : push(JudgeSpawn)
loop while game scene
  m -> eq : fetch events
  m <- eq : events
  loop len(events)
  == event is JudgeSpawn ==
    m -> s : event publish
    m -> f : event publish
    note right of f : ignore
    alt
      note right of s : push event\nin random
      s -> eq : push(Spawn)
    end
    s -> eq : push(JudgeSpawn)
  == event is Spawn ==
    m -> s : event publish
    note right of s : ignore
    m -> f : event publish
    f -> f : spawn()
    note right of f : spawn a new balloon
  end
end

@enduml

PlantUML version 1.2018.02(Sat Mar 10 02:20:44 JST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_162-b12
Operating System: Linux
OS Version: 4.12.14-1-MANJARO
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>